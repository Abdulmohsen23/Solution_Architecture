<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TDF/DT Sizing Criteria</title>

  <style>
    /* ---------- THEME TOKENS (Dark default) ---------- */
    :root{
      --bg: #0f1115;
      --text: #e7eaf0;
      --muted: #9aa4b2;
      --line: #262b36;

      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;

      --opt-bg: #0f1115;
      --opt-text: #e7eaf0;
    }

    /* ---------- LIGHT THEME OVERRIDES ---------- */
    body.light{
      --bg: #f7f8fb;
      --text: #141820;
      --muted: #556070;
      --line: #d8dee8;

      --shadow: 0 10px 25px rgba(20,24,32,.10);

      --opt-bg: #ffffff;
      --opt-text: #141820;
    }

    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(122,162,255,.14), transparent 60%),
        radial-gradient(1000px 700px at 85% 25%, rgba(54,211,153,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:var(--font);
      transition: background .2s ease, color .2s ease;
    }

    .wrap{ max-width: 980px; margin: 32px auto; padding: 0 16px 40px; }

    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom: 18px;
    }
    .title h1{ margin:0; font-size: 22px; letter-spacing:.2px; }
    .title p{ margin:6px 0 0; color:var(--muted); font-size: 13px; line-height:1.4; }

    .topRight{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      backdrop-filter: blur(6px);
    }

    /* ---------- Toggle Switch ---------- */
    .switch{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      user-select:none;
      backdrop-filter: blur(6px);
    }
    .switch input{ display:none; }
    .slider{
      width:44px; height:24px; border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid var(--line);
      position:relative;
      transition: background .2s ease;
      flex: 0 0 auto;
    }
    .slider::after{
      content:"";
      width:18px; height:18px; border-radius:50%;
      background: var(--text);
      position:absolute; top:50%; left:4px;
      transform: translateY(-50%);
      transition: left .2s ease, background .2s ease;
    }
    .switch input:checked + .slider::after{ left:22px; }
    .switch .lbl{ white-space:nowrap; }

    .grid{ display:grid; grid-template-columns: 1.35fr .65fr; gap: 16px; }
    @media (max-width: 880px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card .hd b{ font-size: 13px; letter-spacing:.2px; }
    .card .bd{ padding: 16px; }

    .q{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      background: rgba(0,0,0,.06);
      margin-bottom: 10px;
      transition: transform .15s ease, border-color .15s ease;
    }
    body.light .q{ background: rgba(255,255,255,.55); }
    .q:hover{ transform: translateY(-1px); border-color: rgba(122,162,255,.35); }

    .q label{ display:block; font-size: 13px; margin-bottom: 8px; }
    .hint{ color: var(--muted); font-size: 12px; margin-top: 6px; }

    select, input[type="number"]{
      width: 100%;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      outline:none;
      font-size: 13px;
    }
    body.light select, body.light input[type="number"]{
      background: rgba(255,255,255,.75);
    }

    select option{
      background: var(--opt-bg);
      color: var(--opt-text);
    }

    select:focus, input[type="number"]:focus{
      border-color: rgba(122,162,255,.55);
      box-shadow: 0 0 0 3px rgba(122,162,255,.15);
    }

    input[type="checkbox"]{ transform: translateY(1px); }

    .checks{ display:flex; flex-direction:column; gap:8px; margin-top:4px; }
    .checks .opt{
      display:flex; gap:10px; align-items:center;
      padding: 8px 10px;
      border:1px solid var(--line);
      border-radius: 12px;
      background: rgba(255,255,255,.02);
    }
    body.light .checks .opt{ background: rgba(255,255,255,.75); }
    .checks .opt span{ font-size: 13px; }

    /* Numeric input specific styling */
    .numeric-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .numeric-input-container input[type="number"] {
      padding-right: 40px;
      width: 100%;
    }

    .numeric-controls {
      position: absolute;
      right: 8px;
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .num-btn {
      width: 24px;
      height: 20px;
      padding: 0;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 4px;
      transition: background .15s ease;
    }

    body.light .num-btn { background: rgba(255,255,255,.75); }

    .num-btn:hover {
      background: rgba(122,162,255,.15);
      border-color: rgba(122,162,255,.35);
    }

    .num-btn:active { background: rgba(122,162,255,.25); }

    .num-btn.up { border-bottom-left-radius: 0; border-bottom-right-radius: 0; }
    .num-btn.down { border-top-left-radius: 0; border-top-right-radius: 0; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size: 13px;
      transition: transform .12s ease, border-color .12s ease;
    }
    button:hover{ transform: translateY(-1px); border-color: rgba(122,162,255,.35); }
    .primary{ border-color: rgba(122,162,255,.45); background: rgba(122,162,255,.10); }

    .scoreBox{ display:grid; gap:10px; }

    .kpi{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: rgba(0,0,0,.06);
    }
    body.light .kpi{ background: rgba(255,255,255,.65); }
    .kpi .big{ font-size: 30px; font-weight: 700; margin: 2px 0; }
    .kpi .sub{ color:var(--muted); font-size: 12px; }

    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      width: fit-content;
      margin-top: 6px;
    }

    .badge.small{ border-color: rgba(54,211,153,.40); background: rgba(54,211,153,.10); }
    .badge.medium{ border-color: rgba(122,162,255,.45); background: rgba(122,162,255,.10); }
    .badge.large{ border-color: rgba(251,191,36,.40); background: rgba(251,191,36,.10); }
    .badge.complex{ border-color: rgba(251,113,133,.45); background: rgba(251,113,133,.10); }

    .breakdown{
      border-top:1px solid var(--line);
      margin-top: 10px; padding-top: 10px;
      display:grid; gap: 8px;
    }
    .item{
      display:flex; justify-content:space-between; gap:10px;
      font-size: 12px; color: var(--muted);
    }
    .item b{ color: var(--text); font-weight: 600; }

    .hidden{ display:none; }
    .muted{ color: var(--muted); font-size: 12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>TDF/DT Ticket Sizing</h1>
        <p>Answer the questions and the page will calculate a score and classify the ticket as <b>Small</b>, <b>Medium</b>, <b>Large</b>, or <b>Complex</b>.</p>
      </div>

      <div class="topRight">
        <label class="switch" title="Toggle Light/Dark">
          <span class="lbl">Light</span>
          <input type="checkbox" id="themeToggle" />
          <span class="slider" aria-hidden="true"></span>
          <span class="lbl">Dark</span>
        </label>

        <div class="pill">
          <span>Model:</span>
          <b>Points-based</b>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- Form -->
      <div class="card">
        <div class="hd">
          <b>Classification Criteria</b>
          <div class="btns">
            <button class="primary" id="btnCalc">Calculate</button>
            <button id="btnReset">Reset</button>
          </div>
        </div>

        <div class="bd" id="form">
          <!-- Q1 -->
          <div class="q">
            <label>1) Has this been implemented before or similar to an existing feature/behavior?</label>
            <select id="q1">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
            <div class="hint">Yes reduces complexity (negative points).</div>
          </div>

          <!-- Q2 -->
          <div class="q">
            <label>2) How many impacted systems? (numeric)</label>
            <div class="numeric-input-container">
              <input type="number" id="q2" min="1" step="1" placeholder="e.g., 3" />
              <div class="numeric-controls">
                <button type="button" class="num-btn up" tabindex="-1">▲</button>
                <button type="button" class="num-btn down" tabindex="-1">▼</button>
              </div>
            </div>
            <div class="hint">+1 point per impacted system.</div>
          </div>

          <!-- Q3 -->
          <div class="q">
            <label>3) What is the type of the change?</label>
            <select id="q3">
              <option value="">Select…</option>
              <option value="fe">FE</option>
              <option value="be">BE</option>
              <option value="both">Both</option>
            </select>
          </div>

          <!-- Q4 -->
          <div class="q">
            <label>4) Does it require FE/BE Integration?</label>
            <select id="q4">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          <!-- Q6 -->
          <div class="q">
            <label>5) Does it require core system change?</label>
            <select id="q6">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          <!-- Q7 (conditional) -->
          <div class="q hidden" id="q7Box">
            <label>6) What are the targeted core systems? (multi-select)</label>
            <div class="checks" id="q7">
              <label class="opt"><input type="checkbox" value="eska" /> <span>ESKA</span></label>
              <label class="opt"><input type="checkbox" value="d365" /> <span>Microsoft Dynamics 365 (CRM)</span></label>
              <label class="opt"><input type="checkbox" value="erp" /> <span>ERP</span></label>
              <label class="opt"><input type="checkbox" value="genesys" /> <span>Genesys</span></label>
            </div>
            <div class="hint">ESKA = +3, each other system = +2.</div>
          </div>

          <!-- Q8 -->
          <div class="q">
            <label>7) Does it require third party/aggregator integration?</label>
            <select id="q8">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          <!-- Q9 (conditional) -->
          <div class="q hidden" id="q9Box">
            <label>8) How many integrated third parties? (numeric)</label>
            <div class="numeric-input-container">
              <input type="number" id="q9" min="1" step="1" placeholder="e.g., 2" />
              <div class="numeric-controls">
                <button type="button" class="num-btn up" tabindex="-1">▲</button>
                <button type="button" class="num-btn down" tabindex="-1">▼</button>
              </div>
            </div>
            <div class="hint">+1 point per integrated third party.</div>
          </div>

          <!-- Q10 -->
          <div class="q">
            <label>9) Does it Regulation change by IA?</label>
            <select id="q10">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
            <div class="hint">If Yes, +5 points.</div>
          </div>
        </div>
      </div>

      <!-- Result -->
      <div class="card">
        <div class="hd">
          <b>Result</b>
          <span class="muted">Auto-updated</span>
        </div>

        <div class="bd scoreBox">
          <div class="kpi">
            <div class="sub">Total score</div>
            <div class="big" id="score">—</div>
            <div class="badge" id="sizeBadge">Size: —</div>
            <div class="breakdown" id="breakdown"></div>
          </div>

          <div class="kpi">
            <div class="sub">Thresholds</div>
            <div class="muted" id="thresholdText">
              ≤ 10 = Small<br/>
              11–20 = Medium<br/>
              21–30 = Large<br/>
              31+ = Complex
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    function selectedCheckboxValues(containerId){
      return Array.from(document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`))
        .map(x => x.value);
    }

    function setBoxVisible(boxId, visible){
      $(boxId).classList.toggle('hidden', !visible);
    }

    // Initialize numeric controls
    function initNumericControls() {
      // For Q2
      const q2Input = $("q2");
      const q2UpBtn = document.querySelector('#q2 + .numeric-controls .num-btn.up');
      const q2DownBtn = document.querySelector('#q2 + .numeric-controls .num-btn.down');

      if (q2UpBtn && q2DownBtn) {
        q2UpBtn.addEventListener('click', () => {
          q2Input.stepUp();
          q2Input.dispatchEvent(new Event('input'));
        });

        q2DownBtn.addEventListener('click', () => {
          q2Input.stepDown();
          if (Number(q2Input.value) < 1) q2Input.value = 1;
          q2Input.dispatchEvent(new Event('input'));
        });
      }

      // For Q9
      const q9Input = $("q9");
      if (q9Input) {
        const q9UpBtn = document.querySelector('#q9 + .numeric-controls .num-btn.up');
        const q9DownBtn = document.querySelector('#q9 + .numeric-controls .num-btn.down');

        if (q9UpBtn && q9DownBtn) {
          q9UpBtn.addEventListener('click', () => {
            q9Input.stepUp();
            q9Input.dispatchEvent(new Event('input'));
          });

          q9DownBtn.addEventListener('click', () => {
            q9Input.stepDown();
            if (Number(q9Input.value) < 1) q9Input.value = 1;
            q9Input.dispatchEvent(new Event('input'));
          });
        }
      }
    }

    function updateVisibility(){
      const coreChange = $("q6").value;
      setBoxVisible("q7Box", coreChange === "yes");

      const thirdParty = $("q8").value;
      setBoxVisible("q9Box", thirdParty === "yes");
    }

    // Rebalanced 4-level classification (after removing Q3B + Q5)
    function classify(total){
      if(total <= 10) return { label:"Small", cls:"small" };
      if(total <= 20) return { label:"Medium", cls:"medium" };
      if(total <= 30) return { label:"Large", cls:"large" };
      return { label:"Complex", cls:"complex" };
    }

    function calculate(){
      updateVisibility();

      const breakdown = [];
      let total = 0;
      let valid = true;

      // Q1
      const q1 = $("q1").value;
      if(!q1) valid = false;
      else{
        const pts = (q1 === "yes") ? -9 : 0;
        total += pts;
        breakdown.push(["Q1 Similar implemented", pts]);
      }

      // Q2 (1 point per impacted system)
      const q2 = Number($("q2").value);
      if(!Number.isFinite(q2) || q2 < 1){
        valid = false;
      } else {
        const q2pts = q2 * 1;
        total += q2pts;
        breakdown.push(["Q2 Impacted systems", q2pts]);
      }

      // Q3
      const q3 = $("q3").value;
      if(!q3) valid = false;
      else{
        const map = { fe:2, be:3, both:5 };
        total += map[q3];
        breakdown.push(["Q3 Change type", map[q3]]);
      }

      // Q4
      const q4 = $("q4").value;
      if(!q4) valid = false;
      else{
        const pts = (q4 === "yes") ? 4 : 0;
        total += pts;
        breakdown.push(["Q4 FE/BE integration", pts]);
      }

      // Q6
      const q6 = $("q6").value;
      if(!q6) valid = false;
      else{
        const pts = (q6 === "yes") ? 2 : 0;
        total += pts;
        breakdown.push(["Core system change", pts]);
      }

      // Q7 (core systems): ESKA=3, others=2 (including Genesys)
      if(!$("q7Box").classList.contains("hidden")){
        const vals = selectedCheckboxValues("q7");
        let pts = 0;
        vals.forEach(v => { pts += (v === "eska") ? 3 : 2; });
        total += pts;
        breakdown.push(["Targeted core systems", pts]);
      }

      // Q8
      const q8 = $("q8").value;
      if(!q8) valid = false;
      else{
        const pts = (q8 === "yes") ? 2 : 0;
        total += pts;
        breakdown.push(["Third-party integration", pts]);
      }

      // Q9 (1 point per third party)
      if(!$("q9Box").classList.contains("hidden")){
        const q9 = Number($("q9").value);
        if(!Number.isFinite(q9) || q9 < 1){
          valid = false;
        } else {
          const q9pts = q9 * 1;
          total += q9pts;
          breakdown.push(["# of third parties", q9pts]);
        }
      }

      // Q10 (IA regulation change) => +5 if yes
      const q10 = $("q10").value;
      if(!q10) valid = false;
      else{
        const pts = (q10 === "yes") ? 5 : 0;
        total += pts;
        breakdown.push(["IA regulation change", pts]);
      }

      // Render
      $("score").textContent = valid ? String(total) : "—";

      const badge = $("sizeBadge");
      badge.className = "badge";
      if(valid){
        const res = classify(total);
        badge.textContent = "Size: " + res.label;
        badge.classList.add(res.cls);
      } else {
        badge.textContent = "Size: —";
      }

      // breakdown
      const bd = $("breakdown");
      bd.innerHTML = "";
      breakdown.forEach(([label, pts]) => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<span>${label}</span><b>${pts >= 0 ? "+"+pts : pts}</b>`;
        bd.appendChild(div);
      });
    }

    function resetAll(){
      ["q1","q2","q3","q4","q6","q8","q9","q10"].forEach(id => $(id).value = "");
      document.querySelectorAll('input[type="checkbox"]').forEach(x => x.checked = false);
      updateVisibility();
      calculate();
    }

    /* ---------- Theme Toggle (persist in localStorage) ---------- */
    function applyTheme(mode){
      document.body.classList.toggle("light", mode === "light");
      $("themeToggle").checked = (mode !== "light"); // checked = dark
    }

    function initTheme(){
      const saved = localStorage.getItem("tdfTheme");
      if(saved) applyTheme(saved);
      else applyTheme("dark");

      $("themeToggle").addEventListener("change", () => {
        const mode = $("themeToggle").checked ? "dark" : "light";
        localStorage.setItem("tdfTheme", mode);
        applyTheme(mode);
      });
    }

    // Initialize
    initNumericControls();

    ["q1","q2","q3","q4","q6","q8","q9","q10"].forEach(id => $(id).addEventListener("input", calculate));
    document.querySelectorAll('input[type="checkbox"]').forEach(x => x.addEventListener("change", calculate));

    $("btnCalc").addEventListener("click", calculate);
    $("btnReset").addEventListener("click", resetAll);

    initTheme();
    updateVisibility();
    calculate();
  </script>
</body>
</html>
